<!DOCTYPE html>
<html>
<head>
  <title>üìà Season Stats</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body { font-family: Arial, sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { border: 1px solid #ccc; padding: 8px; text-align: center; }
    input, button { font-size: 16px; margin: 10px; padding: 6px; }
  </style>
</head>
<body>
  <h1>üìà Player Season Totals and Averages</h1>
  <input type="text" id="teamFilter" placeholder="Filter by team name..." oninput="showTotals()">
  <div id="seasonStats"></div>
  <button onclick="window.location.href='index.html'">üè† Return to Menu</button>
  <script>
    function showTotals() {
      const history = JSON.parse(localStorage.getItem("gmGameHistory") || "[]");
      const teamFilter = document.getElementById("teamFilter").value.trim().toLowerCase();
      const totals = {};

      history.forEach(game => {
        const addStats = (team, players) => {
          if (!totals[team]) totals[team] = {};
          players.forEach(player => {
            if (!totals[team][player.name]) {
              totals[team][player.name] = { ...player, games: 1 };
            } else {
              totals[team][player.name].pts += player.pts;
              totals[team][player.name].ast += player.ast;
              totals[team][player.name].reb += player.reb;
              totals[team][player.name].stl += player.stl;
              totals[team][player.name].blk += player.blk;
              totals[team][player.name].games += 1;
            }
          });
        };
        addStats(game.teamA, game.boxA);
        addStats(game.teamB, game.boxB);
      });

      const container = document.getElementById("seasonStats");
      container.innerHTML = "";
      for (const team in totals) {
        if (!team.toLowerCase().includes(teamFilter)) continue;
        const section = document.createElement("div");
        section.innerHTML = `<h3>${team}</h3><table>
          <tr>
            <th>Player</th><th>G</th>
            <th>PTS</th><th>AST</th><th>REB</th><th>STL</th><th>BLK</th>
            <th>PPG</th><th>APG</th><th>RPG</th><th>SPG</th><th>BPG</th>
          </tr>
          ${Object.entries(totals[team]).map(([name, stats]) => {
            const g = stats.games || 1;
            return `<tr>
              <td>${name}</td><td>${g}</td>
              <td>${stats.pts}</td><td>${stats.ast}</td><td>${stats.reb}</td><td>${stats.stl}</td><td>${stats.blk}</td>
              <td>${(stats.pts/g).toFixed(1)}</td>
              <td>${(stats.ast/g).toFixed(1)}</td>
              <td>${(stats.reb/g).toFixed(1)}</td>
              <td>${(stats.stl/g).toFixed(1)}</td>
              <td>${(stats.blk/g).toFixed(1)}</td>
            </tr>`;
          }).join("")}
        </table>`;
        container.appendChild(section);
      }
    }

    showTotals();
  </script>
</body>
</html>
